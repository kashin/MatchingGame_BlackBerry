<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script>
const initialFacesNumber = 5;
const initialLevel = 1;
var facesNumber = initialFacesNumber;
var levelCounter = initialLevel;
var imgSrcUrl = 'local:///assets/images/smile.png';
var leftSide;
var rightSide;

function init() {
  leftSide = document.getElementById('leftGameSide');
  rightSide = document.getElementById('rightGameSide');
  startGame();
}

function startGame() {
  facesNumber = initialFacesNumber;
  levelCounter = initialLevel;
  regenerateSmiles();
}

function clearAllChildNodes(element) {
  while(element.firstChild) {
    element.removeChild(element.firstChild);
  }
}

function regenerateSmiles() {
  clearAllChildNodes(leftSide);
  clearAllChildNodes(rightSide);
  var imgElement;
  for (var i = 0; i < facesNumber; i++) {
    imgElement = document.createElement('img');
    imgElement.src = imgSrcUrl;
    imgElement.style.position = 'absolute';
    imgElement.style.top = Math.floor(Math.random() * (leftSide.offsetHeight - 80)) + 'px';
    imgElement.style.left = Math.floor(Math.random() * (leftSide.offsetWidth - 81)) +
                            'px'; // -81 because 80 px for img size + 1 for border size.
    leftSide.appendChild(imgElement);
  }
  imagesElement = leftSide.cloneNode(true);
  imagesElement.id = '';
  imagesElement.classList.remove('left');
  imagesElement.classList.remove('game-panel');
  imagesElement.removeChild(imagesElement.lastChild);
  rightSide.appendChild(imagesElement);
  leftSide.lastChild.onclick = function correctFaceClicked(event){
    event.stopPropagation();
    facesNumber += 5;
    levelCounter++;
    navigator.cascades.postMessage('imgCounter:' + facesNumber);
    regenerateSmiles();
  };
  leftSide.onclick = function gameOver() {
    navigator.cascades.postMessage('gameOver:' + levelCounter);
    leftSide.onclick = null;
    leftSide.lastChild.onclick = null;
  }; 
}

// handles messages received via WebView.postMessage()
navigator.cascades.onmessage = function onmessage(message) {
  if (message === 'startGame') {
    startGame();
  } else {
    console.log('unhandled message: ' + message);
  }
}



</script>
<style>

html {
  width: 100%;
  height: 100%;
}

body {
  width: 100%;
  height: 100%;
}

.mainPanel {
  width: 100%;
  height: 100%;
  position: relative;
}

.game-panel {
  width: 50%;
  height: calc(100% - 12rem);
  position: absolute;
  top: 12rem;
}

.left {
  left: 0rem;
  border-right: 1px solid black;
}

.right {
  right: 0rem;
}

.headerPanel {
  height: 10rem;
  width: 100%;
  position: absolute;
  top: 0rem;
}

.gameFields {
  width: 100%;
  height: calc(100% - 10rem);
  position: absolute;
  top: 10rem;
  background: url('local:///assets/images/game_background.png') repeat;
}

img {
  position:absolute;
  height: 80px;
  width: 80px;
}
</style>
</head>
<body onload="init()">
  <div class="mainPanel">
    <div class="headerPanel">
      <h1>Matching Game</h1>
      <p>Click on the extra smiling face on the left</p>
    </div>
    <div class="gameFields"></div>
    <div id="leftGameSide" class="game-panel left"></div>
    <div id="rightGameSide" class="game-panel right"></div>
  </div>
</body>
</html>
